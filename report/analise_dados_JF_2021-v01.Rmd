---
title: "Time until implant failure in a knee prosthesis sub-population of the Helios Klinikum Berlin-Buch hospitals"
author: '**From:** Felipe Figueiredo **To:** Jens Freitag'
date: '**Date: ** dd/mm/aaaa'
output:
  html_document:
    fig_caption: yes
    fig_height: 6
    fig_width: 6
    keep_md: yes
    number_sections: yes
    toc: yes
  pdf_document:
    number_sections: yes
    toc: yes
  word_document:
    fig_caption: yes
    fig_height: 6
    fig_width: 6
    reference_docx: misc/style.docx
    toc: yes
subtitle: 'REPORT: analise_dados_JF_2021-v01'
# toc-title: "Sumário"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = normalizePath(".."))
options(scipen = 999)
library(pander)
library(knitr)
library(philsfmisc)
panderOptions('table.style', 'rmarkdown')
panderOptions('table.split.table', Inf)
```

---

**Document version**

```{r, echo = FALSE}
Version <- c("01")
Changes <- c("Initial version")
history <- cbind(Version, Changes)
colnames(history) <- c("Version", "Alterations")
# pander(history, split.cells = 70)
kable(history)
```

---

# Abbreviations

- BMI: body-mass index
- CI: 95% confidence interval
- SD: standard deviation

# Introduction

## Objectives

Evaluate the time-to-failure in a sample of knee prosthesis patient data from the Helios Klinikum Berlin-Buch hospitals

## Data reception and cleaning

The data were be pre-processed, rearranged and cleaned as follows:

- All variables were standardized
  - variable names were standardized for processing purposes, labels were attributed for reporting purposes;
  - observations were standardized according to variable type (numeric, dates, categorical, etc)
- All categorical variables were standardized according to their categories pre-defined in the dictionary provided
  - Gender: M/W
  - Smoking status: No/Yes
  - Joint: L/R
- All dates were standardized and invalid values removed
  - All invalid values like "xxxxxxxxxx",  "xxxxxxxxxxxxxxx", etc were removed before data processing;
- Age were computed as whole years between birth and first surgery, with calendar accuracy;

# Methods

```{r results, include=FALSE}
source("scripts/results.R", encoding = 'UTF-8')
```

## Variables

### Primary and secondary outcomes

Upon inspection of the dates of first surgery and dates of loosening for individual patients, it appears the study period is delimited between 2017-05-10 and 2021-02-25, so these were the dates considered as study start and end.

The event of interest in this analysis is the diagnosis of implant loosening.
The time until the event of interest were computed between the date of first surgery and date of implant loosening.
Patients that reached study end date without implant failure were censored.
Considering the study period of approximately 4 years, Time under observation were measured in years.

### Covariates

Study outcomes were not adjusted for covariates like age, gender or BMI.

## Statistical analyses

Patient characteristics were described with frequency and proportion for categorical variables and mean (SD) for numerical variables.
The main study outcome (time-to-failure) was presented in a Kaplan-Meier plot.
Time-to-failure was cross-analyzed with all selected categorical variables, including gender, smoking status and joint.
Uni-variate analyses were performed using the log-rank test.
All analyses were performed using the significance level of 5%.
All significance hypothesis tests and confidence intervals computed were two-tailed.

### Statistical packages

This analysis was performed using statistical software `R` version `r getRversion()`.
Packages used for survival analyses were `survival` version `r packageVersion("survival")` and `survminer` version `r packageVersion("survminer")`.

# Results

## Study population and follow up

The study population was composed of `r person_years$observations` participants, contributing to a total of `r round(person_years$pyears)` person-years of observation (Table 1).
Gender split was similar with 37 (43%) males and 50 (57%) females, with average (SD) age 61 (11) years.
The typical BMI observed was approximately 30 kg/m²
Twenty participants were smokers and the side of operation was approximately equally distributed in sides.

The prosthesis failure was detected in `r person_years$event` participants, accounting for approximately one quarter of the study population.

```{r}
desc_tab %>% as_kable()
```

Table: **Table 1** Patient characteristics.

## Time to prosthesis failure
```{r}
# summary(sf.1, times = 1:2)
# philsfmisc::format.pct(1-c(0.885,0.821,0.955), 0)
# philsfmisc::format.pct(1-c(0.793,0.712,0.883), 0)
```

Times to prosthesis failure ranged from 7 weeks to almost 3 years (Figure 1).
The total failure rate at the end of study follow up was 23% so the median time of failure could not be estimated.
After one year under observation the rate of failure was 12% (4% -- 18%), while after two years the estimated failure rate is 21% (12% -- 29%).
There were no significant differences among groups when comparing genders, smoking status or the knee side operated on (Table 2).

```{r survival table, warning=FALSE}
inf_tab %>% as_kable()
```

Table: **Table 2** Prosthesis failure probabilities after 2-years of follow up.
p-value: groups compared with the Log-rank test.

![](../figures/km_overall.png)

**Figure 1** Prosthesis loosening.

# Exceptions and Observations

# Conclusions

# References

- **SAP_analise_dados_JF_2021-v01** - Statistical Analysis Plan for Time until implant failure in a knee prosthesis sub-population of the Helios Klinikum Berlin-Buch hospitals

# Appendix

## Exploratory data analysis

![](../figures/km_gender.png)

**Figure 2** Prostheses loosening by gender.

![](../figures/km_smoker.png)

**Figure 3** Prosthesis loosening by smoking status.

![](../figures/km_joint.png)
**Figure 4** Prosthesis loosening by joint operated.

## Analytical data-set

Due to confidentiality the data-set used in this analysis cannot be shared online in the public version of this report.

```{r data}
# pander(analytic)
```
