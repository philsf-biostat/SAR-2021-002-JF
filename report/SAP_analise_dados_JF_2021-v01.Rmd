---
title: "Statistical Analysis Plan for Time until implant failure in a knee prosthesis sub-population of the Helios Klinikum Berlin-Buch hospitals"
author: '**From:** Felipe Figueiredo **To:** Jens Freitag'
date: '**Date: ** dd/mm/aaaa'
output:
  html_document:
    fig_caption: yes
    fig_height: 6
    fig_width: 6
    keep_md: yes
    number_sections: yes
    toc: yes
  pdf_document:
    number_sections: yes
    toc: yes
  word_document:
    fig_caption: yes
    fig_height: 6
    fig_width: 6
    reference_docx: misc/style-SAP.docx
    toc: yes
subtitle: 'SAP: SAP_analise_dados_JF_2021-v01'
# toc-title: "Sum√°rio"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = normalizePath(".."))
options(scipen = 999)
library(pander)
library(knitr)
library(philsfmisc)
panderOptions('table.style', 'rmarkdown')
panderOptions('table.split.table', Inf)
```

---

**Document version**

```{r, echo = FALSE}
Version <- c("01")
Changes <- c("Initial version")
history <- cbind(Version, Changes)
colnames(history) <- c("Version", "Alterations")
# pander(history, split.cells = 70)
kable(history)
```

---


# Abbreviations

- BMI: body mass index

# Introduction

## Context

## Objectives

Evaluate the time-to-failure in a sample of knee prosthesis patient data from the Helios Klinikum Berlin-Buch hospitals

## Hypotheses

# Data cleaning

```{r data, include=FALSE}
source("scripts/input.R", encoding = 'UTF-8')
```

The data will be pre-processed, rearranged and cleaned as follows:

- All variables will be standardized
  - variable names will be standardized for processing purposes, labels will be attributed for reporting purposes;
  - observations will be standardized according to variable type (numeric, dates, categorical, etc)
- All categorical variables will be standardized according to their categories pre-defined in the dictionary provided
  - Gender: M/W
  - Smoking status: No/Yes
  - Joint: L/R
- All dates will be standardized and invalid values removed
  - All invalid values like "xxxxxxxxxx",  "xxxxxxxxxxxxxxx", etc will be removed before data processing;
- Age will be computed as whole years between birth and first surgery, with calendar accuracy;
- 
  
Two observations appear to be test data (Names: Patient 1, Patient 2) and will be removed.

# Study variables

Study variables selected for this analysis are:

- Gender
- Age
- BMI
- Joint operated on
- Smoking status
- Date of surgery
- Date of failure diagnosis

Other variables from the raw dataset will not be used for the analysis.
The event occurrence and time under observation will be computed as defined in the section 4.1.

After all data cleaning and variable selection procedures the analytic dataset should have a similar structure as shown in Table 1.

```{r analytic dataset}
tab_data <- data.frame(
  id = c(1:3, "...", 82),
  "gender" = "", "age"="", "bmi"="", "joint"="", "uka_date"="", "loosening_date"="", event="", time="")
pander(tab_data, split.table = Inf)
```

Table: **Table1** Mock-up example of analytic dataset

The analytic dataset will be included in the private version of the report, and will be omitted from the public version of the report.

## Primary and secondary outcomes

Upon inspection of the dates of first surgery and dates of loosening for individual patients, it appears the study period is delimited between 2017-05-10 and 2021-02-25, so these will be the dates considered as study start and end.

The event of interest in this analysis is the diagnosis of implant loosening.
The time until the event of interest will be computed between the date of first surgery and date of implant loosening.
Patients that reached study end date without implant failure will be censored.

## Covariates

Study outcomes will not be adjusted for covariates like age, gender or BMI.

# Statistical methods

## Statistical analyses

### Descriptive analyses

Patient characteristics will be described with frequency and proportion for categorical variables and mean (SD) for numerical variables.

```{r descriptive table}
desc_tab <- data.frame(
  Characteristic = c("Gender", "M", "W", "Age", "BMI", "Joint", "L", "R", "Loosening", "Success", "Failure"),#rep("", 9),
  N = rep("", 11)
  # row.names = c("Gender", "M", "W", "Age", "BMI", "Joint", "L", "R", "Loosening")
)
pander(desc_tab)
```

Table: **Table 2** Mock-up example of descriptive analysis table

### Inferential analyses

The main study outcome (time-to-failure) will be presented in a Kaplan-Meier plot, and table

Time-to-failure will be cross-analyzed with all selected categorical variables, including gender, smoking status and joint.
Univariate analyses will be performed using the log-rank test.

### Statistical modeling

## Significance and Confidence Intervals

## Study size and Power

### Statistical packages

This analysis will be performed using statistical software `R` version `r getRversion()`.

# Exceptions and Observations

# References

# Appendix

